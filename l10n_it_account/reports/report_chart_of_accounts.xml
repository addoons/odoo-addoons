<?xml version="1.0" encoding="utf-8"?>
<!--
    # -*- coding: utf-8 -*-
    # Part of addOons srl. See LICENSE file for full copyright and licensing details.
    # Copyright 2019 addOons srl (<http://www.addoons.it>)
  -->
<odoo>
    <!-- Report che mostra il piano dei conti raggruppato per prefisso del codice-->

    <template id="report_cof">
        <t t-call="web.basic_layout">
            <t t-call="addoons_reports.internal_minimal_layout">
                <div class="page">
                    <div class="container">

                    </div>
                    <div class="row">
                        <div class="col-6"><h4>PIANO DEI CONTI</h4> </div>
                        <div class="col-6" style="text-align: right;">Stampato il: <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%d-%m-%Y %H:%M')"/></div>
                    </div>
                    <br/>
                    <style>
                        table {
                        border-collapse: collapse;
                        }

                        td, th {
                        border: 1px solid #e6e6e6;
                        padding: 5px;
                        }
                    </style>
                    <table style="width:100%; font-size: medium;border: none;page-break-inside:always;!important" cellspacing="0" cellpadding="10">
                        <tbody>
                            <t t-set="prev_macro" t-value="' '"/>
                            <t t-set="prev_aggregate" t-value="' '"/>
                            <t t-set="account_ids" t-value="docs[0].get_all_accounts()"/>
                            <t t-set="totale_saldo" t-value="0"/>
                            <t t-foreach="account_ids" t-as="doc">
                                <t t-set="aggregate_code" t-value="' '"/>
                                <t t-if="not doc.hierarchy_type_id">
                                    <!--MACRO-->
                                    <t t-if="doc.macroaggregate_id">
                                        <t t-set="macro" t-value="doc.macroaggregate_id.name"/>
                                    </t>
                                    <t t-if="not doc.macroaggregate_id">
                                        <t t-set="macro" t-value="'Non definito'"/>
                                    </t>
                                    <t t-if="macro != prev_macro">
                                        <t t-if="not doc.parent_id">
                                            <t t-set="prev_macro" t-value="'Non definito'"/>
                                        </t>
                                        <t t-if="doc.parent_id">
                                            <t t-set="prev_macro" t-value="doc.macroaggregate_id.name"/>
                                        </t>
                                        <tr class="first_th_row" style="background-color: lightgrey;">
                                            <th colspan="5" t-esc="macro"/>
                                            <t t-if="doc.macroaggregate_id">
                                                <th t-esc="doc.macroaggregate_id.get_macro_balance()" style="text-align:right" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                                <t t-set="totale_saldo" t-value="totale_saldo + doc.macroaggregate_id.get_macro_balance()"/>
                                            </t>
                                            <t t-if="not doc.macroaggregate_id">
                                                <th t-esc="doc.get_not_defined_balance()" style="text-align:right" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                                <t t-set="totale_saldo" t-value="totale_saldo + doc.get_not_defined_balance()"/>
                                            </t>
                                        </tr>
                                    </t>
                                    <!--AGGREGATO-->
                                    <t t-if="doc.parent_id">
                                        <t t-set="aggregate" t-value="doc.parent_id.name"/>
                                    </t>
                                    <t t-if="not doc.parent_id">
                                        <t t-set="macro" t-value="'Non definito'"/>
                                    </t>
                                    <t t-if="aggregate != prev_aggregate">
                                        <t t-if="not doc.parent_id">
                                            <t t-set="prev_aggregate" t-value="'Non definito'"/>
                                        </t>
                                        <t t-if="doc.parent_id">
                                            <t t-set="prev_aggregate" t-value="doc.parent_id.name"/>
                                            <t t-set="aggregate_code" t-value="doc.parent_id.code"/>
                                        </t>
                                        <tr style="background-color: #e6e6e6;">
                                            <th width="5%" style="border: none;background-color: white;!important" t-esc="' '"/>
                                                <th width="95%" colspan="4" t-esc="aggregate_code + ' ' + aggregate"/>
                                            <t t-if="doc.parent_id">
                                                <th t-esc="doc.parent_id.get_aggregate_balance()" style="text-align:right" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                            </t>
                                            <t t-if="not doc.macroaggregate_id">
                                                <th t-esc="doc.get_not_defined_balance()" style="text-align:right" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                            </t>
                                        </tr>
                                    </t>
                                    <tr>
                                        <th width="5%" style="border: none;!important" t-esc="' '"/>
                                        <th width="5%" style="border: none;!important" t-esc="' '"/>
                                        <td width="10%" t-esc="doc.code"/>
                                        <!--<t t-if="doc.parent_id">-->
                                        <!--<td width="40%" t-esc="doc.name + '   ' + doc.parent_id.name"/>-->
                                        <!--</t>-->
                                        <!--<t t-if="not doc.parent_id">-->
                                        <!--<td width="40%" t-esc="doc.name"/>-->
                                        <!--</t>-->
                                        <td width="40%" t-esc="doc.name"/>
                                        <td width="20%" t-esc="doc.hierarchy_type_id.name"/>
                                        <td width="35%" colspan="2" t-esc="doc.balance" style="text-align:right" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </tr>
                                </t>
                            </t>
                            <tr>
                                <td colspan="4" style="border: none !important;"/>
                                <td><span><strong>Saldo Finale</strong></span></td>
                                <td style="text-align:right">
                                    <span>
                                        <strong t-if="totale_saldo != 0"  t-esc="totale_saldo" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                        <span t-if="totale_saldo == 0" style="text-align:right" t-esc="totale_saldo" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                                    </span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </t>
        </t>
    </template>
</odoo>